[{"id":"b57fb94c.9b8988","type":"tab","label":"Heizungssteuerung","disabled":false,"info":""},{"id":"3a1efb78.585874","type":"tab","label":"Mischersteuerung","disabled":false,"info":""},{"id":"37d3dae1.129ff6","type":"tab","label":"Sensoren","disabled":false,"info":""},{"id":"8bcecb62.c30a28","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"6342e945.5022b8","type":"subflow","name":"Sensors","info":"","category":"","in":[],"out":[{"x":1600,"y":780,"wires":[{"id":"3c7a79bc.64f946","port":0}]},{"x":1880,"y":300,"wires":[{"id":"2051a8ff.7b0c1","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"69773ece.1ae77","type":"subflow","name":"Puffer","info":"","category":"","in":[{"x":460,"y":440,"wires":[{"id":"973ae40b.bde488"}]}],"out":[{"x":1320,"y":440,"wires":[{"id":"973ae40b.bde488","port":0}]},{"x":1300,"y":540,"wires":[{"id":"43d6ab08.95dc34","port":0}]},{"x":1300,"y":580,"wires":[{"id":"5344298f.d683a8","port":0}]},{"x":1300,"y":620,"wires":[{"id":"d64d15f4.c663a8","port":0}]},{"x":1300,"y":660,"wires":[{"id":"8c0f2ddd.145798","port":0}]}],"env":[{"name":"Sensor1","type":"str","value":""},{"name":"Sensor2","type":"str","value":""},{"name":"Sensor3","type":"str","value":""},{"name":"Sensor4","type":"str","value":""},{"name":"load_topic","type":"str","value":""},{"name":"automatic_topic","type":"str","value":""}],"color":"#DDAA99","outputLabels":["Weiterleitung von Eingang","Temperatur Sensor 1","Temperatur Sensor 2","Temperatur Sensor 3","Temperatur Sensor 4"]},{"id":"3fb5e607.b8df42","type":"subflow","name":"Sensors (2)","info":"","category":"","in":[],"out":[{"x":1600,"y":780,"wires":[{"id":"157e0cb8.7dea53","port":0}]},{"x":1880,"y":300,"wires":[{"id":"afa4e696.b9b0d8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"2abd751f.509ec2","type":"subflow","name":"Puffer (2)","info":"","category":"","in":[{"x":460,"y":440,"wires":[{"id":"a0da2ac.9c20dd8"}]}],"out":[{"x":1320,"y":440,"wires":[{"id":"a0da2ac.9c20dd8","port":0}]},{"x":1300,"y":540,"wires":[{"id":"e1eeeb50.82bb78","port":0}]},{"x":1300,"y":580,"wires":[{"id":"2cfa16e9.ff93a2","port":0}]},{"x":1300,"y":620,"wires":[{"id":"839a826c.6a1c9","port":0}]},{"x":1300,"y":660,"wires":[{"id":"e7fcee95.e592a8","port":0}]}],"env":[{"name":"Sensor1","type":"str","value":""},{"name":"Sensor2","type":"str","value":""},{"name":"Sensor3","type":"str","value":""},{"name":"Sensor4","type":"str","value":""},{"name":"load_topic","type":"str","value":""},{"name":"automatic_topic","type":"str","value":""}],"color":"#DDAA99","outputLabels":["Weiterleitung von Eingang","Temperatur Sensor 1","Temperatur Sensor 2","Temperatur Sensor 3","Temperatur Sensor 4"]},{"id":"7a539137.52dbf","type":"subflow","name":"Sensors (3)","info":"","category":"","in":[],"out":[{"x":1600,"y":780,"wires":[{"id":"9b23c3ac.835778","port":0}]},{"x":1880,"y":300,"wires":[{"id":"62c97249.ec2fa4","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"a107cfa3.03919","type":"subflow","name":"Puffer (3)","info":"","category":"","in":[{"x":460,"y":440,"wires":[{"id":"809e82a9.80a94"}]}],"out":[{"x":1320,"y":440,"wires":[{"id":"809e82a9.80a94","port":0}]},{"x":1300,"y":540,"wires":[{"id":"8890678a.dd5208","port":0}]},{"x":1300,"y":580,"wires":[{"id":"bc5d99c2.3b6938","port":0}]},{"x":1300,"y":620,"wires":[{"id":"fa52eb45.3c92d8","port":0}]},{"x":1300,"y":660,"wires":[{"id":"1d727d39.da8c2b","port":0}]}],"env":[{"name":"Sensor1","type":"str","value":""},{"name":"Sensor2","type":"str","value":""},{"name":"Sensor3","type":"str","value":""},{"name":"Sensor4","type":"str","value":""},{"name":"load_topic","type":"str","value":""},{"name":"automatic_topic","type":"str","value":""}],"color":"#DDAA99","outputLabels":["Weiterleitung von Eingang","Temperatur Sensor 1","Temperatur Sensor 2","Temperatur Sensor 3","Temperatur Sensor 4"]},{"id":"86f356ab.03ac9","type":"subflow","name":"Sensors (2) (2)","info":"","category":"","in":[],"out":[{"x":1600,"y":780,"wires":[{"id":"13153a65.5fa73e","port":0}]},{"x":1880,"y":300,"wires":[{"id":"a34c06a1.789038","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"52c26041.918658","type":"subflow","name":"Puffer (2) (2)","info":"","category":"","in":[{"x":460,"y":440,"wires":[{"id":"5c0750df.bfd42"}]}],"out":[{"x":1320,"y":440,"wires":[{"id":"5c0750df.bfd42","port":0}]},{"x":1300,"y":540,"wires":[{"id":"1de4b660.4b499a","port":0}]},{"x":1300,"y":580,"wires":[{"id":"136510ee.761fd7","port":0}]},{"x":1300,"y":620,"wires":[{"id":"27bed11b.dcf836","port":0}]},{"x":1300,"y":660,"wires":[{"id":"eb9d72af.b8ad8","port":0}]}],"env":[{"name":"Sensor1","type":"str","value":""},{"name":"Sensor2","type":"str","value":""},{"name":"Sensor3","type":"str","value":""},{"name":"Sensor4","type":"str","value":""},{"name":"load_topic","type":"str","value":""},{"name":"automatic_topic","type":"str","value":""}],"color":"#DDAA99","outputLabels":["Weiterleitung von Eingang","Temperatur Sensor 1","Temperatur Sensor 2","Temperatur Sensor 3","Temperatur Sensor 4"]},{"id":"85d6d873.2cc96","type":"group","z":"6342e945.5022b8","name":"Perstistent SensorMapping","style":{"label":true},"nodes":["7625d37f.3eb944","5aa8fcdd.231404","c4873c3a.96b57","74215adf.93f864","5a48d541.a29f84","f993ad9b.7c8ac8"],"x":274,"y":239},{"id":"afd37b21.b2467","type":"group","z":"b57fb94c.9b8988","name":"Messung","style":{"fill":"#d1d1d1","label":true,"color":"#000000"},"nodes":["8e96b703.ed372","cbed44c0.1c3cd","bc686379.fd1cd","f47880a.4ea198","186c5d52.308beb","1437094b.b5bcb7","b6697deb.808468","6604a78.cccf358","ba930620.89c358","7401f969.142608","ca717c05.cf363","eb64df23.1fb06","ab8addc8.9da8e","4f13540b.0991f4","e5b659dd.2234c8","dc1a57d5.362cf8","a55b7d43.24d8a","82a57f9e.35ee9","38e6ff7b.dc68f","9ac75c30.7e6b4","5c1d6a7.2a28f94","4bcd96be.6015b","2aa8abd6.b3fa64","a1b0e83f.b91dd8","9c26027c.3ff2a","f0d0a5b.e1b35d8"],"x":334,"y":19,"w":1512,"h":642},{"id":"2a476917.bb71de","type":"group","z":"b57fb94c.9b8988","name":"Allgemein","style":{"fill":"#d1d1d1","label":true,"color":"#000000"},"nodes":["be5c71dd.2374f","689b2e22.0dbab","e804ef83.857228","6fea053f.5b563c","c78d8efa.fab13","c6b91987.7b6118","d36a1012.3d4e58","1247c6df.9ab199","4950ec27.23af4c","527ed735.b1fa3","1838a68a.903409","b49303ed.663b6"],"x":394,"y":1931.5,"w":1012,"h":437},{"id":"c052861.feaa2f8","type":"group","z":"3fb5e607.b8df42","name":"Perstistent SensorMapping","style":{"label":true},"nodes":["ac4d8f61.43a6a8","9eff2a2d.85f96","c1c72d53.f7d8","fb94ba49.6a5a7","83caba30.249548","4c9502d8.c6117c"],"x":274,"y":239},{"id":"6dda4cf5.098e8c","type":"group","z":"b57fb94c.9b8988","name":"Heizkreis und Mischer","style":{"fill":"#d1d1d1","label":true,"color":"#000000"},"nodes":["4a1351bd.769e88","84702e63.4b8ff8","5badc1a0.0b7508","8c75a7af.c1283","e57b3f74.2b55c","c6a905ef.04755","fb9d0ebe.b82c9","9dcf4bb8.a5c938","1b04e39.b949d9c","7e4417e1.688f7","5d087073.23a1a","eee574cd.9e0168","b97a2cbb.61c64","705d2ce8.c70f8c","595bf487.c0f7d4","654c3ff8.2755","4b4eff53.e2cc5","e253139f.32c058","3404fbb0.1b60fc","224ad929.6ff38e","d2f7e83a.67a998","86134fc5.ebc688","a9ee8054.a5f52","fc952fdc.db8098","2f1510a3.679598","62e68dd7.921764","54b870b9.2a3a48"],"x":144,"y":1239,"w":1232,"h":522},{"id":"5bd16a38.6f76fc","type":"group","z":"7a539137.52dbf","name":"Perstistent SensorMapping","style":{"label":true},"nodes":["9e55b69f.5978d8","89a352e7.ba6b2","b99f3cf6.b28e8","b15ab789.9ba838","72ad485f.6cc758","3efefea.4c50a82"],"x":274,"y":239},{"id":"3d69e6e9.ceea6a","type":"group","z":"86f356ab.03ac9","name":"Perstistent SensorMapping","style":{"label":true},"nodes":["ddccb540.92268","7653ec06.c2480c","418d2baa.7e2294","3f9bf5db.52d082","283a3b83.796df4","bc332ed7.ed634"],"x":274,"y":239},{"id":"bcebf477.ab97e8","type":"mqtt-broker","name":"MQTT on 192.168.1.38","broker":"192.168.1.38","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"100","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"578f88c6.d37518","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#ec7000","baseFont":"Lucida Sans Unicode,Lucida Grande,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#ec7000","edited":true},"page-titlebar-backgroundColor":{"value":"#ec7000","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#ff9739","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#ec7000","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"Lucida Sans Unicode,Lucida Grande,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Ottn IoT Zentrale","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":1,"py":1}}},{"id":"4b772f87.12ab1","type":"ui_tab","name":"Heizung","icon":"dashboard","disabled":false,"hidden":false},{"id":"ebb1ed1c.5ebe2","type":"ui_tab","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"a4d65fc0.4b0f28","type":"ui_tab","name":"Verlauf","icon":"dashboard","disabled":false,"hidden":false},{"id":"63dfa255.33424c","type":"ui_group","name":"Puffer Brauchwasser","tab":"4b772f87.12ab1","order":3,"disp":true,"width":"4","collapse":true},{"id":"77dbbe3a.99fa3","type":"ui_group","name":"Puffer Heizkreis","tab":"4b772f87.12ab1","order":2,"disp":true,"width":"4","collapse":true},{"id":"526921e2.2519f","type":"ui_group","name":"Mischer","tab":"4b772f87.12ab1","order":4,"disp":true,"width":"6","collapse":true},{"id":"16acd5a3.070ef2","type":"ui_group","name":"Puffer Heizraum","tab":"4b772f87.12ab1","order":1,"disp":true,"width":"4","collapse":true},{"id":"a562987.7dc6f68","type":"ui_group","name":"Parameter","tab":"4b772f87.12ab1","order":7,"disp":true,"width":"4","collapse":true},{"id":"2ac8e3fa.8b8584","type":"ui_group","name":"Default","tab":"ebb1ed1c.5ebe2","order":1,"disp":true,"width":"12","collapse":false},{"id":"28bde750.d2c1f8","type":"ui_group","name":"Heizungspumpe","tab":"4b772f87.12ab1","order":5,"disp":true,"width":"4","collapse":true},{"id":"8a48955d.4ec298","type":"ui_group","name":"Allgemein","tab":"4b772f87.12ab1","order":8,"disp":true,"width":"4","collapse":true},{"id":"951f63e6.78df","type":"ui_group","name":"Garage","tab":"","order":2,"disp":false,"width":"10"},{"id":"8ac8701e.7362d","type":"ui_group","name":"Verlaufsübersicht","tab":"a4d65fc0.4b0f28","order":8,"disp":true,"width":"15","collapse":false},{"id":"307dd413.a8ab24","type":"mqtt-broker","name":"versorgung","broker":"192.168.1.101","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"333b3454.447904","type":"mqtt-broker","name":"heizraum","broker":"192.168.1.10","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"10788b43.59cf15","type":"ui_group","name":"Dashboard","tab":"970798f9.ff53c8","order":1,"disp":true,"width":"6","collapse":false},{"id":"970798f9.ff53c8","type":"ui_tab","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"b801e008.796bb","type":"inject","z":"6342e945.5022b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":160,"wires":[["7625d37f.3eb944"]]},{"id":"62ab3979.9f94b8","type":"delay","z":"6342e945.5022b8","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1180,"y":380,"wires":[[]]},{"id":"5ea53c4d.2fe074","type":"split","z":"6342e945.5022b8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1500,"y":300,"wires":[["2051a8ff.7b0c1"]]},{"id":"2051a8ff.7b0c1","type":"function","z":"6342e945.5022b8","name":"FileAsTopic","func":"msg_out = {'topic': 'raw_data/' + msg.payload.file, 'payload': msg.payload}\n\n\nreturn msg_out;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":300,"wires":[[]]},{"id":"3b4de692.9dd81a","type":"function","z":"6342e945.5022b8","name":"StoreInContext","func":"sensors_dict = flow.get('sensors');\n\n// Replace all the defined mappings\n//for (let sensor in msg.payload) {\n    sensors_dict[msg.payload.file] = msg.payload.id\n//}\n\nmsg = {'payload': sensors_dict}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// Access the node's context object\n//var nodeContext = this.context;\n//var flowContext = this.context.flow;\n//var globalContext = this.context.global;\n\n\nflow.set('sensors', {});","finalize":"","x":1940,"y":540,"wires":[["74215adf.93f864"]]},{"id":"3c7a79bc.64f946","type":"function","z":"6342e945.5022b8","name":"Id2NameMapping","func":"sensors_dict = flow.get('sensors');\n\n// Replace all the defined mappings\nresult = {};\nresult.topic = msg.topic;\nresult.payload = [];\n\nfor (var sensor of msg.payload) {\n    if (sensor.file in sensors_dict) {\n        sensor.id = sensors_dict[sensor.file];\n    }\n    result.payload.push(sensor);\n}\n\nreturn result;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// Access the node's context object\n//var nodeContext = this.context;\n//var flowContext = this.context.flow;\n//var globalContext = this.context.global;\n\nflow.set('sensors', {})","finalize":"","x":1450,"y":540,"wires":[["a1c7043d.9d4c98"]]},{"id":"9e444069.20175","type":"debug","z":"6342e945.5022b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1900,"y":600,"wires":[]},{"id":"43d6ab08.95dc34","type":"mqtt in","z":"69773ece.1ae77","name":"","topic":"${Sensor1}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":540,"wires":[["6be15e6a.a83738"]]},{"id":"5344298f.d683a8","type":"mqtt in","z":"69773ece.1ae77","name":"","topic":"${Sensor2}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":580,"wires":[["6be15e6a.a83738"]]},{"id":"d64d15f4.c663a8","type":"mqtt in","z":"69773ece.1ae77","name":"","topic":"${Sensor3}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":620,"wires":[["6be15e6a.a83738"]]},{"id":"8c0f2ddd.145798","type":"mqtt in","z":"69773ece.1ae77","name":"","topic":"${Sensor4}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":660,"wires":[["6be15e6a.a83738"]]},{"id":"6be15e6a.a83738","type":"function","z":"69773ece.1ae77","name":"Store Temperatures Globally","func":"\ntemp_map = global.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nglobal.set('temperatures', {});","finalize":"","x":600,"y":480,"wires":[["727b48d2.94e9b"]]},{"id":"34052e89.ecb0aa","type":"change","z":"69773ece.1ae77","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":360,"wires":[["edeace50.280bb8"]]},{"id":"a67b7b3.cff6008","type":"mqtt in","z":"69773ece.1ae77","name":"","topic":"${automatic_topic}","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":290,"y":360,"wires":[["34052e89.ecb0aa"]]},{"id":"edeace50.280bb8","type":"function","z":"69773ece.1ae77","name":"SetEnabledContext","func":"flow.set('is_enabled', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nflow.set('is_enabled', true);","finalize":"","x":760,"y":360,"wires":[["973ae40b.bde488"]]},{"id":"973ae40b.bde488","type":"function","z":"69773ece.1ae77","name":"Build Message","func":"msg = {};\nmsg.payload = {};\n\nmsg.payload.temperatures = flow.get('temperatures');\nmsg.payload.is_loading = flow.get('is_loading') || false; // default false\nmsg.payload.is_enabled = flow.get('is_enabled'); // enabled by default\nmsg.topic = env.get(\"load_topic\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":440,"wires":[[]]},{"id":"727b48d2.94e9b","type":"function","z":"69773ece.1ae77","name":"Store Temperatures Locally","func":"\ntemp_map = flow.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nflow.set('temperatures', {});","finalize":"","x":880,"y":480,"wires":[["973ae40b.bde488"]]},{"id":"7625d37f.3eb944","type":"file in","z":"6342e945.5022b8","g":"85d6d873.2cc96","name":"","filename":"/home/pi/sens.yaml","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":420,"y":280,"wires":[["5aa8fcdd.231404"]]},{"id":"5aa8fcdd.231404","type":"yaml","z":"6342e945.5022b8","g":"85d6d873.2cc96","property":"payload","name":"","x":610,"y":280,"wires":[["c4873c3a.96b57"]]},{"id":"c4873c3a.96b57","type":"function","z":"6342e945.5022b8","g":"85d6d873.2cc96","name":"SetSensors","func":"flow.set('sensors', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":280,"wires":[[]]},{"id":"74215adf.93f864","type":"function","z":"6342e945.5022b8","g":"85d6d873.2cc96","name":"GetSensors","func":"return {'payload': flow.get('sensors')};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":440,"wires":[["5a48d541.a29f84"]]},{"id":"5a48d541.a29f84","type":"yaml","z":"6342e945.5022b8","g":"85d6d873.2cc96","property":"payload","name":"","x":570,"y":440,"wires":[["f993ad9b.7c8ac8"]]},{"id":"f993ad9b.7c8ac8","type":"file","z":"6342e945.5022b8","g":"85d6d873.2cc96","name":"","filename":"/home/pi/sens.yaml","appendNewline":true,"createDir":false,"overwriteFile":"true","encoding":"none","x":820,"y":440,"wires":[[]]},{"id":"a1c7043d.9d4c98","type":"split","z":"6342e945.5022b8","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1660,"y":700,"wires":[["7d1ff69f.24c98"]]},{"id":"d9e8f806.b746b8","type":"mqtt out","z":"6342e945.5022b8","name":"","topic":"","qos":"0","retain":"false","broker":"bcebf477.ab97e8","x":2010,"y":700,"wires":[]},{"id":"7d1ff69f.24c98","type":"function","z":"6342e945.5022b8","name":"IdAsTopic","func":"msg_out = {'topic': 'sensors/' + msg.payload.id, 'payload': msg.payload.temp}\n\n\nreturn msg_out;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":700,"wires":[["d9e8f806.b746b8"]]},{"id":"513d96e7.1e0488","type":"change","z":"69773ece.1ae77","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":300,"wires":[["91caccf1.01d248"]]},{"id":"722e484d.4019c","type":"mqtt in","z":"69773ece.1ae77","name":"","topic":"${load_topic}","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":310,"y":300,"wires":[["513d96e7.1e0488"]]},{"id":"91caccf1.01d248","type":"function","z":"69773ece.1ae77","name":"SetLoadingContext","func":"flow.set('is_loading', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":300,"wires":[[]]},{"id":"8e96b703.ed372","type":"mqtt in","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","topic":"sensors/heizkreis/1","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":470,"y":400,"wires":[[]]},{"id":"cbed44c0.1c3cd","type":"mqtt in","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","topic":"sensors/heizkreis/2","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":470,"y":460,"wires":[[]]},{"id":"bc686379.fd1cd","type":"mqtt in","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","topic":"sensors/heizkreis/3","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":470,"y":520,"wires":[[]]},{"id":"f47880a.4ea198","type":"mqtt in","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","topic":"sensors/heizkreis/4","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":470,"y":580,"wires":[[]]},{"id":"186c5d52.308beb","type":"mqtt in","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","topic":"sensors/brauchwasser/1","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":470,"y":120,"wires":[[]]},{"id":"1437094b.b5bcb7","type":"mqtt in","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","topic":"sensors/brauchwasser/2","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":470,"y":180,"wires":[[]]},{"id":"b6697deb.808468","type":"mqtt in","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","topic":"sensors/brauchwasser/3","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":470,"y":240,"wires":[[]]},{"id":"6604a78.cccf358","type":"mqtt in","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","topic":"sensors/brauchwasser/4","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":470,"y":300,"wires":[[]]},{"id":"ba930620.89c358","type":"mqtt in","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","topic":"sensors/heizkreis/vorlauf_ist","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":1080,"y":560,"wires":[["4f13540b.0991f4","e5b659dd.2234c8","a55b7d43.24d8a"]]},{"id":"7401f969.142608","type":"mqtt in","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","topic":"sensors/aussentemperatur","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":1070,"y":340,"wires":[["ca717c05.cf363","e5b659dd.2234c8","a55b7d43.24d8a"]]},{"id":"ca717c05.cf363","type":"ui_chart","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","group":"526921e2.2519f","order":1,"width":0,"height":0,"label":"Aussentemperatur","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Keine Temperaturdaten vorhanden","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1450,"y":340,"wires":[[]]},{"id":"4a1351bd.769e88","type":"ui_switch","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","label":"Heizbetrieb","tooltip":"Schaltet die Heizungspumpe an oder aus","group":"28bde750.d2c1f8","order":2,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","topicType":"str","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":true,"x":910,"y":1280,"wires":[["5badc1a0.0b7508"]]},{"id":"84702e63.4b8ff8","type":"mqtt in","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"pumpe/heizkreis/ein","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":330,"y":1340,"wires":[["e57b3f74.2b55c"]]},{"id":"5badc1a0.0b7508","type":"mqtt out","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"pumpe/heizkreis/ein","qos":"2","retain":"true","broker":"bcebf477.ab97e8","x":1120,"y":1280,"wires":[]},{"id":"56f8ad0.a762854","type":"mqtt in","z":"b57fb94c.9b8988","name":"","topic":"puffer/heizkreis/load","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":310,"y":940,"wires":[["ccd48d5b.b01d18"]]},{"id":"dad45050.d57b78","type":"ui_switch","z":"b57fb94c.9b8988","d":true,"name":"","label":"Laden","tooltip":"","group":"77dbbe3a.99fa3","order":10,"width":"4","height":"4","passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":750,"y":940,"wires":[["2e8a9cb6.a2cbec"]]},{"id":"2e8a9cb6.a2cbec","type":"mqtt out","z":"b57fb94c.9b8988","d":true,"name":"","topic":"puffer/heizkreis/load","qos":"2","retain":"","broker":"307dd413.a8ab24","x":940,"y":940,"wires":[]},{"id":"ccd48d5b.b01d18","type":"change","z":"b57fb94c.9b8988","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":940,"wires":[["dad45050.d57b78","8ce31f73.897d08"]]},{"id":"8c75a7af.c1283","type":"rpi-gpio out","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"Pumpe Heizkreis","pin":"3","set":false,"level":"0","freq":"","out":"out","x":1110,"y":1340,"wires":[]},{"id":"37d507d6.bb369","type":"rpi-gpio out","z":"b57fb94c.9b8988","d":true,"name":"Pumpe Brauchwasser","pin":"15","set":false,"level":"0","freq":"","out":"out","x":980,"y":840,"wires":[]},{"id":"c45bfffb.5b7","type":"mqtt in","z":"b57fb94c.9b8988","name":"","topic":"puffer/brauchwasser/load","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":330,"y":780,"wires":[["71980f25.c16d78"]]},{"id":"77965284.874d8c","type":"ui_switch","z":"b57fb94c.9b8988","d":true,"name":"","label":"Laden","tooltip":"","group":"63dfa255.33424c","order":11,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":750,"y":780,"wires":[["a6c91629.8d1608"]]},{"id":"a6c91629.8d1608","type":"mqtt out","z":"b57fb94c.9b8988","d":true,"name":"","topic":"puffer/brauchwasser/load","qos":"2","retain":"","broker":"bcebf477.ab97e8","x":950,"y":780,"wires":[]},{"id":"71980f25.c16d78","type":"change","z":"b57fb94c.9b8988","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":780,"wires":[["77965284.874d8c","bff8134e.05c05"]]},{"id":"d35bb7af.d11bb","type":"pi-gpiod out","z":"b57fb94c.9b8988","d":true,"name":"Pumpe Fernwaermeleitung","host":"192.168.1.101","port":8888,"pin":"17","set":false,"level":"0","out":"out","sermin":"1000","sermax":"2000","x":960,"y":1020,"wires":[]},{"id":"e57b3f74.2b55c","type":"change","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":1340,"wires":[["4a1351bd.769e88","c6a905ef.04755"]]},{"id":"eb64df23.1fb06","type":"mqtt in","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","topic":"mischer/heizkreis/vorlauf_soll","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":1080,"y":460,"wires":[["ab8addc8.9da8e","e5b659dd.2234c8","a55b7d43.24d8a"]]},{"id":"ab8addc8.9da8e","type":"ui_chart","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","group":"526921e2.2519f","order":2,"width":0,"height":0,"label":"Vorlauftemperatur Soll","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Keine Daten","dot":false,"ymin":"20","ymax":"60","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1460,"y":480,"wires":[[]]},{"id":"4f13540b.0991f4","type":"ui_chart","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","group":"526921e2.2519f","order":3,"width":0,"height":0,"label":"Vorlauftemperatur Ist","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"Keine Daten","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":1460,"y":560,"wires":[[]]},{"id":"be5c71dd.2374f","type":"exec","z":"b57fb94c.9b8988","g":"2a476917.bb71de","command":"sudo systemctl restart","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":1980,"wires":[[],["e804ef83.857228"],[]]},{"id":"689b2e22.0dbab","type":"ui_button","z":"b57fb94c.9b8988","g":"2a476917.bb71de","name":"","group":"8a48955d.4ec298","order":5,"width":0,"height":0,"passthru":false,"label":"Alle Module Neustart","tooltip":"","color":"","bgcolor":"","icon":"","payload":"thermoberry-sensors.service thermoberry-buffers.service thermoberry-mixer.service thermoberry-heating-circuit.service","payloadType":"str","topic":"","x":520,"y":1980,"wires":[["be5c71dd.2374f"]]},{"id":"e804ef83.857228","type":"ui_toast","z":"b57fb94c.9b8988","g":"2a476917.bb71de","position":"top right","displayTime":"10","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"on error","x":1300,"y":2120,"wires":[]},{"id":"6fea053f.5b563c","type":"ui_button","z":"b57fb94c.9b8988","g":"2a476917.bb71de","name":"","group":"8a48955d.4ec298","order":6,"width":0,"height":0,"passthru":false,"label":"Hardware Reset","tooltip":"","color":"","bgcolor":"red","icon":"","payload":"","payloadType":"str","topic":"","x":500,"y":2160,"wires":[["c78d8efa.fab13"]]},{"id":"c78d8efa.fab13","type":"exec","z":"b57fb94c.9b8988","g":"2a476917.bb71de","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":810,"y":2160,"wires":[[],["e804ef83.857228"],[]]},{"id":"c6a905ef.04755","type":"function","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"Invert","func":"msg.payload = !msg.payload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":1340,"wires":[["8c75a7af.c1283"]]},{"id":"8ce31f73.897d08","type":"function","z":"b57fb94c.9b8988","name":"Invert","func":"msg.payload = !msg.payload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1020,"wires":[["d35bb7af.d11bb"]]},{"id":"bff8134e.05c05","type":"function","z":"b57fb94c.9b8988","name":"Invert","func":"msg.payload = !msg.payload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":840,"wires":[["37d507d6.bb369"]]},{"id":"fb9d0ebe.b82c9","type":"ui_switch","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","label":"Automatik","tooltip":"Aktiviert die automatische Regelung des Mischers","group":"526921e2.2519f","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","topicType":"str","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":true,"x":750,"y":1660,"wires":[["eee574cd.9e0168"]]},{"id":"9dcf4bb8.a5c938","type":"ui_switch","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","label":"Heiss","tooltip":"Stellt Manuell auf Heiss","group":"526921e2.2519f","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1050,"y":1460,"wires":[["3404fbb0.1b60fc"]]},{"id":"1b04e39.b949d9c","type":"ui_switch","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","label":"Kalt","tooltip":"Stellt manuell auf kalt","group":"526921e2.2519f","order":6,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1060,"y":1520,"wires":[["e253139f.32c058"]]},{"id":"7e4417e1.688f7","type":"function","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"MutualExclusive","func":"\nmsg1 = {\"payload\": false};\nmsg2 = {\"payload\": false};\nmsg3 = {\"payload\": false};\n\n\nif (msg.topic == \"mischer/automatik\")\n    msg1.payload = msg.payload;\nif (msg.topic == \"mischer/heizkreis/heiss\")\n    msg2.payload = msg.payload;\nif (msg.topic == \"mischer/heizkreis/kalt\")\n    msg3.payload = msg.payload;\n\n/*\n// This forces one state to be true\nif (msg.topic == \"Mischer/Automatik\")\n    msg1.payload = true;\nif (msg.topic == \"Mischer/Heiss\")\n    msg2.payload = true;\nif (msg.topic == \"Mischer/Kalt\")\n    msg3.payload = true;\n*/\n\nreturn [msg1, msg2, msg3];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":730,"y":1480,"wires":[[],["9dcf4bb8.a5c938","54b870b9.2a3a48"],["1b04e39.b949d9c","62e68dd7.921764"]]},{"id":"5d087073.23a1a","type":"rpi-gpio out","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"Mischer Waermer","pin":"11","set":false,"level":"0","freq":"","out":"out","x":1100,"y":1400,"wires":[]},{"id":"eee574cd.9e0168","type":"mqtt out","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"mischer/heizkreis/automatik","qos":"2","retain":"true","broker":"bcebf477.ab97e8","x":1010,"y":1660,"wires":[]},{"id":"b97a2cbb.61c64","type":"rpi-gpio out","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"Mischer Kaelter","pin":"13","set":false,"level":"0","freq":"","out":"out","x":1090,"y":1580,"wires":[]},{"id":"705d2ce8.c70f8c","type":"mqtt in","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"mischer/heizkreis/automatik","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":290,"y":1660,"wires":[["595bf487.c0f7d4"]]},{"id":"595bf487.c0f7d4","type":"change","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1660,"wires":[["fb9d0ebe.b82c9"]]},{"id":"654c3ff8.2755","type":"mqtt in","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"mischer/heizkreis/heiss","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":270,"y":1440,"wires":[["224ad929.6ff38e"]]},{"id":"4b4eff53.e2cc5","type":"mqtt in","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"mischer/heizkreis/kalt","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":270,"y":1500,"wires":[["d2f7e83a.67a998"]]},{"id":"e253139f.32c058","type":"mqtt out","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"mischer/heizkreis/kalt","qos":"2","retain":"true","broker":"bcebf477.ab97e8","x":1230,"y":1520,"wires":[]},{"id":"3404fbb0.1b60fc","type":"mqtt out","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"mischer/heizkreis/heiss","qos":"2","retain":"true","broker":"bcebf477.ab97e8","x":1240,"y":1460,"wires":[]},{"id":"224ad929.6ff38e","type":"change","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1440,"wires":[["7e4417e1.688f7"]]},{"id":"d2f7e83a.67a998","type":"change","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1500,"wires":[["7e4417e1.688f7"]]},{"id":"86134fc5.ebc688","type":"ui_switch","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","label":"Automatik","tooltip":"Schaltet die Automatik der Heizungspumpe an oder aus","group":"28bde750.d2c1f8","order":1,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"heizbetrieb","topicType":"str","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":true,"x":750,"y":1720,"wires":[["fc952fdc.db8098"]]},{"id":"a9ee8054.a5f52","type":"mqtt in","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"steuerung/heizkreis/automatik","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":290,"y":1720,"wires":[["2f1510a3.679598"]]},{"id":"fc952fdc.db8098","type":"mqtt out","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"","topic":"steuerung/heizkreis/automatik","qos":"2","retain":"true","broker":"bcebf477.ab97e8","x":1020,"y":1720,"wires":[]},{"id":"2f1510a3.679598","type":"change","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1720,"wires":[["86134fc5.ebc688"]]},{"id":"62e68dd7.921764","type":"function","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"Invert","func":"msg.payload = !msg.payload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":1580,"wires":[["b97a2cbb.61c64"]]},{"id":"54b870b9.2a3a48","type":"function","z":"b57fb94c.9b8988","g":"6dda4cf5.098e8c","name":"Invert","func":"msg.payload = !msg.payload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":1400,"wires":[["5d087073.23a1a"]]},{"id":"c6b91987.7b6118","type":"ui_button","z":"b57fb94c.9b8988","d":true,"g":"2a476917.bb71de","name":"","group":"8a48955d.4ec298","order":7,"width":0,"height":0,"passthru":false,"label":"Werkseinstellungen wiederherstellen","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":570,"y":2240,"wires":[["d36a1012.3d4e58"]]},{"id":"d36a1012.3d4e58","type":"exec","z":"b57fb94c.9b8988","g":"2a476917.bb71de","command":"git --git-dir=/home/pi/Thermoberry/.git checkout HEAD -- conf/config.yaml","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1000,"y":2240,"wires":[[],["e804ef83.857228"],[]]},{"id":"c0a2c9bd.3646b","type":"rpi-ds18b20","z":"3fb5e607.b8df42","topic":"","array":true,"name":"","x":1170,"y":280,"wires":[["7df36f55.bfd4c","6366ff47.4e9788","157e0cb8.7dea53"]]},{"id":"e4fad473.b23d28","type":"inject","z":"3fb5e607.b8df42","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":160,"wires":[["ac4d8f61.43a6a8"]]},{"id":"7df36f55.bfd4c","type":"delay","z":"3fb5e607.b8df42","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1180,"y":380,"wires":[["c0a2c9bd.3646b"]]},{"id":"6366ff47.4e9788","type":"split","z":"3fb5e607.b8df42","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1500,"y":300,"wires":[["afa4e696.b9b0d8"]]},{"id":"afa4e696.b9b0d8","type":"function","z":"3fb5e607.b8df42","name":"FileAsTopic","func":"msg_out = {'topic': 'raw_data/' + msg.payload.file, 'payload': msg.payload}\n\n\nreturn msg_out;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":300,"wires":[[]]},{"id":"86ef8ddf.898058","type":"function","z":"3fb5e607.b8df42","name":"StoreInContext","func":"sensors_dict = flow.get('sensors');\n\n// Replace all the defined mappings\n//for (let sensor in msg.payload) {\n    sensors_dict[msg.payload.file] = msg.payload.id\n//}\n\nmsg = {'payload': sensors_dict}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// Access the node's context object\n//var nodeContext = this.context;\n//var flowContext = this.context.flow;\n//var globalContext = this.context.global;\n\n\nflow.set('sensors', {});","finalize":"","x":1940,"y":540,"wires":[["fb94ba49.6a5a7"]]},{"id":"8c33af97.1a4588","type":"ui_template","z":"3fb5e607.b8df42","group":"8a48955d.4ec298","name":"","order":1,"width":0,"height":0,"format":"\n\n<form>\n    <fieldset style=\"width:85%\">\n    <legend>choose chartdata</legend>\n        <div ng-repeat=\"sensor in msg.payload\">\n            <label>{{sensor.file}}\n                <input  type=\"text\" style=\"float:right;\"\n                        ng-model=\"sensor.id\"\n                        ng-change=\"send({'payload': sensor})\"\n                        >\n            </label>\n        </div>\n    </fieldset>\n</form>\n\n<script>\n    \n    // Source: https://it.knightnet.org.uk/kb/nr-qa/dashboard-template-examples/#a-couple-of-ways-to-send-a-msg-back-to-node-red\n    \n    // Replace all the defined mappings\n    scope.on_change_2 = function(msg) {\n        sensors_dict = this.flow.get('sensors');\n        sensors_dict[msg.payload.file] = msg.payload.id\n        this.send(msg);\n    }.bind(scope);\n    \n    \n    ;(function (scope) {\n        \n        scope.on_change = function (msg) {\n            sensors_dict = scope.flow.get('sensors');\n            sensors_dict[msg.payload.file] = msg.payload.id\n            scope.send(msg);\n        }\n    })(scope)\n    \n</script>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":true,"templateScope":"local","x":1660,"y":540,"wires":[["86ef8ddf.898058","a613a51b.1f138"]]},{"id":"157e0cb8.7dea53","type":"function","z":"3fb5e607.b8df42","name":"Id2NameMapping","func":"sensors_dict = flow.get('sensors');\n\n// Replace all the defined mappings\nresult = {};\nresult.topic = msg.topic;\nresult.payload = [];\n\nfor (var sensor of msg.payload) {\n    if (sensor.file in sensors_dict) {\n        sensor.id = sensors_dict[sensor.file];\n    }\n    result.payload.push(sensor);\n}\n\nreturn result;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// Access the node's context object\n//var nodeContext = this.context;\n//var flowContext = this.context.flow;\n//var globalContext = this.context.global;\n\nflow.set('sensors', {})","finalize":"","x":1450,"y":540,"wires":[["8c33af97.1a4588","b2ad130e.f1865"]]},{"id":"a613a51b.1f138","type":"debug","z":"3fb5e607.b8df42","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1900,"y":600,"wires":[]},{"id":"fc5dae71.9da868","type":"subflow:2abd751f.509ec2","z":"b57fb94c.9b8988","name":"Puffer Heizraum","env":[{"name":"Sensor1","value":"sensors/heizraum/1","type":"str"},{"name":"Sensor2","value":"sensors/heizraum/2","type":"str"},{"name":"Sensor3","value":"sensors/heizraum/3","type":"str"},{"name":"Sensor4","value":"sensors/heizraum/4","type":"str"},{"name":"load_topic","value":"puffer/heizraum/load","type":"str"},{"name":"automatic_topic","value":"puffer/heizraum/automatik","type":"str"}],"x":1290,"y":780,"wires":[[],["5d21b7e0.5c4dd","9b2a40eb.4118a8"],["5d21b7e0.5c4dd","500666fd.fcadf8"],["5d21b7e0.5c4dd","1dae14b5.0a116b"],["5d21b7e0.5c4dd","4f1dff7a.cd798"]]},{"id":"e1eeeb50.82bb78","type":"mqtt in","z":"2abd751f.509ec2","name":"","topic":"${Sensor1}","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":540,"wires":[["30b45c0b.21834c"]]},{"id":"2cfa16e9.ff93a2","type":"mqtt in","z":"2abd751f.509ec2","name":"","topic":"${Sensor2}","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":580,"wires":[["30b45c0b.21834c"]]},{"id":"839a826c.6a1c9","type":"mqtt in","z":"2abd751f.509ec2","name":"","topic":"${Sensor3}","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":620,"wires":[["30b45c0b.21834c"]]},{"id":"e7fcee95.e592a8","type":"mqtt in","z":"2abd751f.509ec2","name":"","topic":"${Sensor4}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":660,"wires":[["30b45c0b.21834c"]]},{"id":"30b45c0b.21834c","type":"function","z":"2abd751f.509ec2","name":"Store Temperatures Globally","func":"\ntemp_map = global.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nglobal.set('temperatures', {});","finalize":"","x":600,"y":480,"wires":[["ca36556e.ca3298"]]},{"id":"9c26027c.3ff2a","type":"ui_gauge","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","group":"16acd5a3.070ef2","order":8,"width":4,"height":3,"gtype":"gage","title":"Temperatur 4","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0000ff","#ffff00","#ff0000"],"seg1":"35","seg2":"","x":1390,"y":240,"wires":[]},{"id":"a1b0e83f.b91dd8","type":"ui_gauge","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","group":"16acd5a3.070ef2","order":7,"width":4,"height":3,"gtype":"gage","title":"Temperatur 3","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0000ff","#ffff00","#ff0000"],"seg1":"35","seg2":"","x":1390,"y":180,"wires":[]},{"id":"6bba0199.496aa","type":"change","z":"2abd751f.509ec2","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":360,"wires":[["6a83910a.97ed58"]]},{"id":"dfe8d7aa.f96168","type":"mqtt in","z":"2abd751f.509ec2","name":"","topic":"${automatic_topic}","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":290,"y":360,"wires":[["6bba0199.496aa"]]},{"id":"6a83910a.97ed58","type":"function","z":"2abd751f.509ec2","name":"SetEnabledContext","func":"flow.set('is_enabled', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nflow.set('is_enabled', true);","finalize":"","x":760,"y":360,"wires":[["a0da2ac.9c20dd8"]]},{"id":"62f4abcb.cb7eb4","type":"subflow:2abd751f.509ec2","z":"b57fb94c.9b8988","name":"Puffer Heizkreis","env":[{"name":"Sensor1","value":"sensors/heizkreis/1","type":"str"},{"name":"Sensor2","value":"sensors/heizkreis/2","type":"str"},{"name":"Sensor3","value":"sensors/heizkreis/3","type":"str"},{"name":"Sensor4","value":"sensors/heizkreis/4","type":"str"},{"name":"load_topic","value":"puffer/heizkreis/load","type":"str"},{"name":"automatic_topic","value":"puffer/heizkreis/automatik","type":"str"}],"x":1440,"y":1020,"wires":[["98c44b0c.c4497","29ef11c3.4e8436"],["918cf2fc.c3d6e8","d596693e.546cb"],["f07f90cb.094f88","d596693e.546cb"],["ada2d521.616248","d596693e.546cb"],["73192d9f.1555fc","d596693e.546cb"]]},{"id":"7333f22f.38277c","type":"subflow:2abd751f.509ec2","z":"b57fb94c.9b8988","name":"Puffer Brauchwasser","env":[{"name":"Sensor1","value":"sensors/brauchwasser/1","type":"str"},{"name":"Sensor2","value":"sensors/brauchwasser/2","type":"str"},{"name":"Sensor3","value":"sensors/brauchwasser/3","type":"str"},{"name":"Sensor4","value":"sensors/brauchwasser/4","type":"str"},{"name":"load_topic","value":"puffer/brauchwasser/load","type":"str"},{"name":"automatic_topic","value":"puffer/brauchwasser/automatik","type":"str"}],"x":1620,"y":1320,"wires":[["e14479d2.6de1e","78a2d7e8.0f07a"],["4951933d.382c5c"],["b199fe9b.8a686"],["ec904ad.4157738"],["28f22549.795ce2"]]},{"id":"4951933d.382c5c","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"63dfa255.33424c","order":5,"width":4,"height":3,"gtype":"gage","title":"Temperatur 1","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0000ff","#ffff00","#ff0000"],"seg1":"30","seg2":"","x":1910,"y":1340,"wires":[]},{"id":"b199fe9b.8a686","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"63dfa255.33424c","order":6,"width":4,"height":3,"gtype":"gage","title":"Temperatur 2","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0000ff","#ffff00","#ff0000"],"seg1":"30","seg2":"","x":1910,"y":1380,"wires":[]},{"id":"ec904ad.4157738","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"63dfa255.33424c","order":7,"width":4,"height":3,"gtype":"gage","title":"Temperatur 3","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#4233ff","#b4d257","#ff2b2b"],"seg1":"30","seg2":"","x":1910,"y":1420,"wires":[]},{"id":"28f22549.795ce2","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"63dfa255.33424c","order":8,"width":4,"height":3,"gtype":"gage","title":"Temperatur 4","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0066ff","#aeee44","#ff3333"],"seg1":"","seg2":"","x":1910,"y":1460,"wires":[]},{"id":"73192d9f.1555fc","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"77dbbe3a.99fa3","order":8,"width":4,"height":3,"gtype":"gage","title":"Temperatur 4","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0000ff","#ffff00","#ff0000"],"seg1":"45","seg2":"","x":1880,"y":1100,"wires":[]},{"id":"ada2d521.616248","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"77dbbe3a.99fa3","order":7,"width":4,"height":3,"gtype":"gage","title":"Temperatur 3","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0000ff","#ffff00","#ff0000"],"seg1":"35","seg2":"","x":1880,"y":1060,"wires":[]},{"id":"f07f90cb.094f88","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"77dbbe3a.99fa3","order":6,"width":4,"height":3,"gtype":"gage","title":"Temperatur 2","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0000ff","#ffff00","#ff0000"],"seg1":"35","seg2":"","x":1880,"y":1020,"wires":[]},{"id":"918cf2fc.c3d6e8","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"77dbbe3a.99fa3","order":5,"width":4,"height":3,"gtype":"gage","title":"Temperatur 1","label":"°C","format":"{{value}}","min":"20","max":"80","colors":["#0000ff","#ffff00","#ff0000"],"seg1":"35","seg2":"","x":1880,"y":980,"wires":[]},{"id":"18af501f.e303b8","type":"ui_switch","z":"b57fb94c.9b8988","name":"","label":"Laden","tooltip":"","group":"77dbbe3a.99fa3","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","topicType":"str","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":true,"x":2250,"y":860,"wires":[["23610037.99f31"]]},{"id":"a0da2ac.9c20dd8","type":"function","z":"2abd751f.509ec2","name":"Build Message","func":"msg = {};\nmsg.payload = {};\n\nmsg.payload.temperatures = flow.get('temperatures');\nmsg.payload.is_loading = flow.get('is_loading') || false; // default false\nmsg.payload.is_enabled = flow.get('is_enabled'); // enabled by default\nmsg.topic = env.get(\"load_topic\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":440,"wires":[[]]},{"id":"e14479d2.6de1e","type":"function","z":"b57fb94c.9b8988","name":"Loading Decision","func":"global_temperatures = global.get('temperatures');\ntemperatures = msg.payload.temperatures;\n\n\n// Load parameters from message\n// TODO\n\n// Rule 0: automatic or manual mode\nis_enabled = msg.payload.is_enabled;\n\n// Rule 1: temperature too high -> stop loading\nis_hot = temperatures['sensors/brauchwasser/4'] > 55;\n\n// Rule 2: temperature too low -> start loading\nis_cold = temperatures['sensors/brauchwasser/4'] < 50;\n\n// Rule 3: check if we have some sufficient supplier\nloss = 2;\n// Winter:\ncan_load = Object.values(temperatures).every(t => t <global_temperatures['sensors/heizkreis/1'] );\nload_end = temperatures['sensors/heizkreis/1'] < 63;\n// Sommer:\n//can_load = Object.values(temperatures).every(t => t <global_temperatures['sensors/heizraum/1'] );\n//load_end = temperatures['sensors/heizraum/1'] < 65;\n// Rule 4: Force loading if supplier is overheading\noverheat_protection = global_temperatures['sensors/heizkreis/4'] > 71;\n    \nif (!is_enabled) {\n    // manual mode -> do nothing automatically\n    new_loading_state = msg.payload.is_loading;\n}\n\nelse if (overheat_protection) {\n    // protect the supplier by taking the hot water\n    new_loading_state = true;\n}\n\nelse if (is_hot) {\n    // stop because buffer is full\n    new_loading_state = false;\n}\n\nelse if (load_end) {\n    // disable as soon as we cannot load anymore\n    new_loading_state = false;\n}\n\nelse if (is_cold && can_load) {\n    // start loading as soon as we are getting too cold\n    new_loading_state = true;\n}\n\n\nelse {\n    new_loading_state = msg.payload.is_loading;\n}\n\n\nresult = {};\nresult.payload = new_loading_state;\nresult.topic = msg.topic;\n\n\nif (result.payload != msg.payload.is_loading) {\n    //loading state changed\n    reason = {}\n    reason.payload = \"\";\n    reason.payload += \"is_hot: \" + is_hot;\n    reason.payload += \" | is_cold: \" + is_cold;\n    reason.payload += \" | can_load: \" + can_load;\n    reason.payload += \" | overheat_protection: \" + overheat_protection;\n} else {\n    reason = undefined;\n}\n\n\nreturn [result, reason];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1910,"y":1280,"wires":[["3fce63de.621544"],["1e6f416b.7e109f"]]},{"id":"3fce63de.621544","type":"ui_switch","z":"b57fb94c.9b8988","name":"","label":"Laden","tooltip":"","group":"63dfa255.33424c","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","topicType":"str","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":true,"x":2110,"y":1300,"wires":[["730b4e9e.7409e","2a28a4b2.b67184"]]},{"id":"730b4e9e.7409e","type":"mqtt out","z":"b57fb94c.9b8988","name":"","topic":"puffer/brauchwasser/load","qos":"2","retain":"true","broker":"bcebf477.ab97e8","x":2510,"y":1280,"wires":[]},{"id":"23610037.99f31","type":"mqtt out","z":"b57fb94c.9b8988","name":"","topic":"puffer/heizkreis/load","qos":"","retain":"true","broker":"bcebf477.ab97e8","x":2700,"y":860,"wires":[]},{"id":"1e6f416b.7e109f","type":"switch","z":"b57fb94c.9b8988","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":2220,"y":1040,"wires":[["1d9fc8f9.eaa59f"]]},{"id":"1d9fc8f9.eaa59f","type":"ui_toast","z":"b57fb94c.9b8988","position":"top right","displayTime":"10","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Reason for Switch","x":2430,"y":1040,"wires":[]},{"id":"ca36556e.ca3298","type":"function","z":"2abd751f.509ec2","name":"Store Temperatures Locally","func":"\ntemp_map = flow.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nflow.set('temperatures', {});","finalize":"","x":880,"y":480,"wires":[["a0da2ac.9c20dd8"]]},{"id":"2875deb8.a50ca2","type":"pi-gpiod out","z":"b57fb94c.9b8988","d":true,"name":"Pumpe Fernwaermeleitung","host":"192.168.1.101","port":8888,"pin":"17","set":false,"level":"1","out":"out","sermin":"1000","sermax":"2000","x":2700,"y":920,"wires":[]},{"id":"76d67d91.334f34","type":"function","z":"b57fb94c.9b8988","name":"Invert","func":"msg.payload = !msg.payload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2410,"y":920,"wires":[["2875deb8.a50ca2"]]},{"id":"2a28a4b2.b67184","type":"function","z":"b57fb94c.9b8988","name":"Invert","func":"msg.payload = !msg.payload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2270,"y":1360,"wires":[["7c42a6a2.4be75"]]},{"id":"7c42a6a2.4be75","type":"rpi-gpio out","z":"b57fb94c.9b8988","name":"Pumpe Brauchwasser","pin":"15","set":false,"level":"0","freq":"","out":"out","x":2500,"y":1360,"wires":[]},{"id":"ac4d8f61.43a6a8","type":"file in","z":"3fb5e607.b8df42","g":"c052861.feaa2f8","name":"","filename":"/home/pi/sens.yaml","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":420,"y":280,"wires":[["9eff2a2d.85f96"]]},{"id":"9eff2a2d.85f96","type":"yaml","z":"3fb5e607.b8df42","g":"c052861.feaa2f8","property":"payload","name":"","x":610,"y":280,"wires":[["c1c72d53.f7d8"]]},{"id":"c1c72d53.f7d8","type":"function","z":"3fb5e607.b8df42","g":"c052861.feaa2f8","name":"SetSensors","func":"flow.set('sensors', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":280,"wires":[["c0a2c9bd.3646b"]]},{"id":"fb94ba49.6a5a7","type":"function","z":"3fb5e607.b8df42","g":"c052861.feaa2f8","name":"GetSensors","func":"return {'payload': flow.get('sensors')};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":440,"wires":[["83caba30.249548"]]},{"id":"83caba30.249548","type":"yaml","z":"3fb5e607.b8df42","g":"c052861.feaa2f8","property":"payload","name":"","x":570,"y":440,"wires":[["4c9502d8.c6117c"]]},{"id":"4c9502d8.c6117c","type":"file","z":"3fb5e607.b8df42","g":"c052861.feaa2f8","name":"","filename":"/home/pi/sens.yaml","appendNewline":true,"createDir":false,"overwriteFile":"true","encoding":"none","x":820,"y":440,"wires":[[]]},{"id":"b2ad130e.f1865","type":"split","z":"3fb5e607.b8df42","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1660,"y":700,"wires":[["a05f13b1.72b2b"]]},{"id":"d7ff29f9.4fd9","type":"mqtt out","z":"3fb5e607.b8df42","name":"","topic":"","qos":"0","retain":"false","broker":"bcebf477.ab97e8","x":2010,"y":700,"wires":[]},{"id":"a05f13b1.72b2b","type":"function","z":"3fb5e607.b8df42","name":"IdAsTopic","func":"msg_out = {'topic': 'sensors/' + msg.payload.id, 'payload': msg.payload.temp}\n\n\nreturn msg_out;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":700,"wires":[["d7ff29f9.4fd9"]]},{"id":"e5b659dd.2234c8","type":"function","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"Store Temperatures Globally","func":"\ntemp_map = global.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nglobal.set('temperatures', {});","finalize":"","x":1440,"y":400,"wires":[[]]},{"id":"3a510198.16496e","type":"change","z":"2abd751f.509ec2","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":300,"wires":[["37b3d97e.19d8b6"]]},{"id":"3da98469.528c2c","type":"mqtt in","z":"2abd751f.509ec2","name":"","topic":"${load_topic}","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":310,"y":300,"wires":[["3a510198.16496e"]]},{"id":"37b3d97e.19d8b6","type":"function","z":"2abd751f.509ec2","name":"SetLoadingContext","func":"flow.set('is_loading', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":300,"wires":[[]]},{"id":"53cd8d5e.9545fc","type":"ui_switch","z":"b57fb94c.9b8988","name":"","label":"Automatik","tooltip":"","group":"63dfa255.33424c","order":9,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":2250,"y":1220,"wires":[["d5016e0a.3bfee8"]]},{"id":"d5016e0a.3bfee8","type":"mqtt out","z":"b57fb94c.9b8988","name":"","topic":"puffer/brauchwasser/automatik","qos":"2","retain":"true","broker":"bcebf477.ab97e8","x":2510,"y":1220,"wires":[]},{"id":"773affca.f0931","type":"ui_switch","z":"b57fb94c.9b8988","name":"","label":"Automatik","tooltip":"","group":"77dbbe3a.99fa3","order":9,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","topicType":"str","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":true,"x":2370,"y":800,"wires":[["ac17dd0e.a562"]]},{"id":"ac17dd0e.a562","type":"mqtt out","z":"b57fb94c.9b8988","name":"","topic":"puffer/heizkreis/automatik","qos":"2","retain":"true","broker":"bcebf477.ab97e8","x":2620,"y":800,"wires":[]},{"id":"98c44b0c.c4497","type":"change","z":"b57fb94c.9b8988","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"(payload.is_enabled)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2110,"y":800,"wires":[["773affca.f0931"]]},{"id":"78a2d7e8.0f07a","type":"change","z":"b57fb94c.9b8988","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"(payload.is_enabled)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1930,"y":1220,"wires":[["53cd8d5e.9545fc"]]},{"id":"6b25bb48.442e6c","type":"ui_template","z":"b57fb94c.9b8988","group":"8a48955d.4ec298","name":"Clock Toolbar","order":8,"width":"0","height":"0","format":"<script id=\"titleScript\" type=\"text/javascript\">\n    $('#clock').remove();\n    var toolbar = $('.md-toolbar-tools');\n    var div = $('<div/>');\n    var p = $('<p/ id=\"clock\">');\n    \n    $('#titleScript').parent().hide();\n    div.append(p);\n    div[0].style.margin = '5px 5px 5px auto';\n    toolbar.append(div);\n\n    function displayTitle(lh) {\n        p.text(lh); \n    }\n    \n    function upTime() {\n        var d = new Date();\n        p.text(d.toLocaleTimeString('de-AT'));\n    }\n\n    \n\n    // Watch the payload and update the title\n    (function(scope) {\n        scope.$watch('msg.payload', function(data) {\n            displayTitle(data);\n        });\n        setInterval(upTime,1000);\n    })(scope);\n</script>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":1920,"y":520,"wires":[[]]},{"id":"489bc1e5.58124","type":"ui_button","z":"b57fb94c.9b8988","name":"","group":"8a48955d.4ec298","order":3,"width":0,"height":0,"passthru":false,"label":"Sensormodul Neustart","tooltip":"","color":"","bgcolor":"","icon":"","payload":"thermoberry-sensors.service","payloadType":"str","topic":"","x":520,"y":2020,"wires":[["be5c71dd.2374f"]]},{"id":"4950ec27.23af4c","type":"ui_button","z":"b57fb94c.9b8988","g":"2a476917.bb71de","name":"","group":"8a48955d.4ec298","order":4,"width":0,"height":0,"passthru":false,"label":"Mischermodul Neustart","tooltip":"","color":"","bgcolor":"","icon":"","payload":"thermoberry-mixer.service","payloadType":"str","topic":"","x":530,"y":2100,"wires":[["be5c71dd.2374f"]]},{"id":"1247c6df.9ab199","type":"ui_button","z":"b57fb94c.9b8988","g":"2a476917.bb71de","name":"","group":"8a48955d.4ec298","order":2,"width":0,"height":0,"passthru":false,"label":"Heizkreismodul Neustart","tooltip":"","color":"","bgcolor":"","icon":"","payload":"thermoberry-heating-circuit.service","payloadType":"str","topic":"","topicType":"str","x":530,"y":2060,"wires":[["be5c71dd.2374f"]]},{"id":"97c67cdd.3e41e8","type":"ui_chart","z":"b57fb94c.9b8988","name":"","group":"8ac8701e.7362d","order":3,"width":"15","height":"5","label":"Langzeit Heizpuffer und Vorlauf","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"20","ymax":"80","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#ff4848","#808080","#ffff00","#80ff00","#00ffff","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1950,"y":1160,"wires":[[]]},{"id":"1adccbef.d9becc","type":"ui_chart","z":"b57fb94c.9b8988","name":"","group":"8ac8701e.7362d","order":1,"width":"15","height":"4","label":"Langzeit Hauptpuffer","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"20","ymax":"80","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#ff0000","#ffff00","#80ff00","#00ffff","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1540,"y":920,"wires":[[]]},{"id":"dc1a57d5.362cf8","type":"ui_chart","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","group":"8ac8701e.7362d","order":4,"width":"15","height":"5","label":"Vorlauftemperaturen Langzeit","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"20","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#00ff00","#0000ff","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1690,"y":620,"wires":[[]]},{"id":"29ef11c3.4e8436","type":"function","z":"b57fb94c.9b8988","name":"Load Decision","func":"global_temperatures = global.get('temperatures');\ntemperatures = msg.payload.temperatures;\n\n\n// Load parameters from message\n// TODO\n\n\n// Rule 0: automatic or manual mode\nis_enabled = msg.payload.is_enabled;\n\n// Rule 1: temperature too high -> stop loading\nis_hot = Object.values(temperatures).every(t => t -2 >global_temperatures['sensors/heizkreis/vorlauf_ist'] - 1 );\n\n// Rule 2: temperature too low -> start loading\nis_cold = Object.values(temperatures).every(t => t - 4 <global_temperatures['mischer/heizkreis/vorlauf_soll'] );\n\n// Rule 3: check if we have some sufficient supplier\nloss = 3;\nstop_load = 8;\ncan_load = Object.values(temperatures).some(t => t <global_temperatures['sensors/heizraum/1'] - loss );\nload_end = Object.values(temperatures).some(t => t - stop_load >global_temperatures['sensors/heizraum/1'] );\n\n// Rule 4: Force loading if supplier is overheading\noverheat_protection = global_temperatures['sensors/heizraum/4'] > 74;\n    \n\nif (!is_enabled) {\n    // manual mode -> do nothing automatically\n    new_loading_state = msg.payload.is_loading;\n}\n\nelse if (overheat_protection) {\n    // protect the supplier by taking the hot water\n    new_loading_state = true;\n}\n\nelse if (is_hot) {\n    // stop because buffer is full\n    new_loading_state = false;\n}\n\nelse if (load_end) {\n    // disable as soon as we cannot load anymore\n    new_loading_state = false;\n}\n\nelse if (is_cold && can_load) {\n    // start loading as soon as we are getting too cold\n    new_loading_state = true;\n}\n\n\nelse {\n    new_loading_state = msg.payload.is_loading;\n}\n\nresult = {};\nresult.payload = new_loading_state;\nresult.topic = msg.topic;\n\n\nif (result.payload != msg.payload.is_loading) {\n    //loading state changed\n    reason = {}\n    reason.payload = \"\";\n    reason.payload += \" is_hot: \" + is_hot;\n    reason.payload += \" | is_cold: \" + is_cold;\n    reason.payload += \" | can_load: \" + can_load;\n    reason.payload += \" | load_end: \" + load_end;\n    reason.payload += \" | overheat_protection: \" + overheat_protection;\n} \nelse {\n    reason = undefined;\n}\n\n\nreturn [ result, reason, msg ];\n//(killed) return msg;","outputs":2,"noerr":0,"initialize":"","finalize":"","x":2070,"y":880,"wires":[["18af501f.e303b8"],["1e6f416b.7e109f"]]},{"id":"583d6991.0a6f58","type":"mqtt in","z":"b57fb94c.9b8988","name":"","topic":"puffer/brauchwasser/load","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":1670,"y":1660,"wires":[["7cfa85d4.ff250c"]]},{"id":"9671ee92.23d548","type":"change","z":"b57fb94c.9b8988","name":"String2Number","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"1","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2180,"y":1680,"wires":[["3ed0ba8b.abd60e"]]},{"id":"3ed0ba8b.abd60e","type":"ui_chart","z":"b57fb94c.9b8988","name":"","group":"8ac8701e.7362d","order":1,"width":"15","height":"4","label":"Langzeit Pumpen","chartType":"line","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"-1","ymax":"2","removeOlder":"20","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#ff0000","#ffff00","#80ff00","#00ffff","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":2370,"y":1680,"wires":[[]]},{"id":"d4f59feb.ca93f8","type":"mqtt in","z":"b57fb94c.9b8988","name":"","topic":"mischer/heizkreis/vorlauf_soll","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":1240,"y":1140,"wires":[["d596693e.546cb"]]},{"id":"d1c58609.7b8f7","type":"mqtt in","z":"b57fb94c.9b8988","name":"","topic":"pumpe/heizkreis/ein","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":1650,"y":1780,"wires":[["7cfa85d4.ff250c"]]},{"id":"b500eef.e6d291","type":"mqtt in","z":"b57fb94c.9b8988","name":"","topic":"puffer/heizkreis/load","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":1650,"y":1720,"wires":[["7cfa85d4.ff250c"]]},{"id":"527ed735.b1fa3","type":"ui_button","z":"b57fb94c.9b8988","g":"2a476917.bb71de","name":"","group":"8a48955d.4ec298","order":4,"width":0,"height":0,"passthru":false,"label":"Software Update","tooltip":"","color":"","bgcolor":"","icon":"","payload":"thermoberry-mixer.service","payloadType":"str","topic":"","topicType":"str","x":510,"y":2320,"wires":[["1838a68a.903409"]]},{"id":"1838a68a.903409","type":"exec","z":"b57fb94c.9b8988","g":"2a476917.bb71de","command":"git --git-dir=/home/pi/Thermoberry/.git pull","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":840,"y":2320,"wires":[["b49303ed.663b6"],["e804ef83.857228"],[]]},{"id":"b49303ed.663b6","type":"ui_toast","z":"b57fb94c.9b8988","g":"2a476917.bb71de","position":"top right","displayTime":"10","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"on success","x":1310,"y":2320,"wires":[]},{"id":"7cfa85d4.ff250c","type":"delay","z":"b57fb94c.9b8988","name":"","pauseType":"timed","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"60","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1940,"y":1700,"wires":[["9671ee92.23d548"]]},{"id":"d596693e.546cb","type":"delay","z":"b57fb94c.9b8988","name":"","pauseType":"timed","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"60","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1640,"y":1160,"wires":[["97c67cdd.3e41e8"]]},{"id":"5d21b7e0.5c4dd","type":"delay","z":"b57fb94c.9b8988","name":"","pauseType":"timed","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"60","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1540,"y":860,"wires":[["1adccbef.d9becc"]]},{"id":"a55b7d43.24d8a","type":"delay","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","pauseType":"timed","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"60","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1400,"y":620,"wires":[["dc1a57d5.362cf8"]]},{"id":"82a57f9e.35ee9","type":"mqtt in","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"sensors/heizraum/3","topic":"sensors/heizraum/3","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":1070,"y":180,"wires":[["a1b0e83f.b91dd8"]]},{"id":"38e6ff7b.dc68f","type":"mqtt in","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","topic":"sensors/heizraum/4","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":1070,"y":240,"wires":[["9c26027c.3ff2a"]]},{"id":"9ac75c30.7e6b4","type":"mqtt in","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","topic":"sensors/heizraum/2","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":1070,"y":120,"wires":[["2aa8abd6.b3fa64"]]},{"id":"5c1d6a7.2a28f94","type":"mqtt in","z":"b57fb94c.9b8988","g":"afd37b21.b2467","name":"","topic":"sensors/heizraum/1","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":1070,"y":60,"wires":[["4bcd96be.6015b"]]},{"id":"2aa8abd6.b3fa64","type":"ui_gauge","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","group":"16acd5a3.070ef2","order":3,"width":0,"height":0,"gtype":"gage","title":"Temperatur 2","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1390,"y":120,"wires":[]},{"id":"4bcd96be.6015b","type":"ui_gauge","z":"b57fb94c.9b8988","d":true,"g":"afd37b21.b2467","name":"","group":"16acd5a3.070ef2","order":2,"width":0,"height":0,"gtype":"gage","title":"Temperatur 1","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1390,"y":60,"wires":[]},{"id":"9b2a40eb.4118a8","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"16acd5a3.070ef2","order":4,"width":0,"height":0,"gtype":"gage","title":"Temperatur 1","label":"units","format":"{{value}}","min":"20","max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1730,"y":680,"wires":[]},{"id":"500666fd.fcadf8","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"16acd5a3.070ef2","order":5,"width":0,"height":0,"gtype":"gage","title":"Temperatur 2","label":"units","format":"{{value}}","min":"20","max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1730,"y":720,"wires":[]},{"id":"1dae14b5.0a116b","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"16acd5a3.070ef2","order":6,"width":0,"height":0,"gtype":"gage","title":"Temperatur 3","label":"units","format":"{{value}}","min":"20","max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1730,"y":760,"wires":[]},{"id":"4f1dff7a.cd798","type":"ui_gauge","z":"b57fb94c.9b8988","name":"","group":"16acd5a3.070ef2","order":7,"width":0,"height":0,"gtype":"gage","title":"Temperatur 4","label":"units","format":"{{value}}","min":"20","max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1730,"y":800,"wires":[]},{"id":"ca7df7b3.7b0c68","type":"inject","z":"7a539137.52dbf","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":160,"wires":[["9e55b69f.5978d8"]]},{"id":"3ce7e82c.54a048","type":"delay","z":"7a539137.52dbf","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1180,"y":380,"wires":[[]]},{"id":"8b534c8c.1e41a","type":"split","z":"7a539137.52dbf","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1500,"y":300,"wires":[["62c97249.ec2fa4"]]},{"id":"62c97249.ec2fa4","type":"function","z":"7a539137.52dbf","name":"FileAsTopic","func":"msg_out = {'topic': 'raw_data/' + msg.payload.file, 'payload': msg.payload}\n\n\nreturn msg_out;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":300,"wires":[[]]},{"id":"1b758ed2.ac7909","type":"function","z":"7a539137.52dbf","name":"StoreInContext","func":"sensors_dict = flow.get('sensors');\n\n// Replace all the defined mappings\n//for (let sensor in msg.payload) {\n    sensors_dict[msg.payload.file] = msg.payload.id\n//}\n\nmsg = {'payload': sensors_dict}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// Access the node's context object\n//var nodeContext = this.context;\n//var flowContext = this.context.flow;\n//var globalContext = this.context.global;\n\n\nflow.set('sensors', {});","finalize":"","x":1940,"y":540,"wires":[["b15ab789.9ba838"]]},{"id":"9b23c3ac.835778","type":"function","z":"7a539137.52dbf","name":"Id2NameMapping","func":"sensors_dict = flow.get('sensors');\n\n// Replace all the defined mappings\nresult = {};\nresult.topic = msg.topic;\nresult.payload = [];\n\nfor (var sensor of msg.payload) {\n    if (sensor.file in sensors_dict) {\n        sensor.id = sensors_dict[sensor.file];\n    }\n    result.payload.push(sensor);\n}\n\nreturn result;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// Access the node's context object\n//var nodeContext = this.context;\n//var flowContext = this.context.flow;\n//var globalContext = this.context.global;\n\nflow.set('sensors', {})","finalize":"","x":1450,"y":540,"wires":[["60b8819b.a1f37"]]},{"id":"277f216b.3a00ae","type":"debug","z":"7a539137.52dbf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1900,"y":600,"wires":[]},{"id":"8890678a.dd5208","type":"mqtt in","z":"a107cfa3.03919","name":"","topic":"${Sensor1}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":540,"wires":[["c9c16dc0.77def8"]]},{"id":"bc5d99c2.3b6938","type":"mqtt in","z":"a107cfa3.03919","name":"","topic":"${Sensor2}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":580,"wires":[["c9c16dc0.77def8"]]},{"id":"fa52eb45.3c92d8","type":"mqtt in","z":"a107cfa3.03919","name":"","topic":"${Sensor3}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":620,"wires":[["c9c16dc0.77def8"]]},{"id":"1d727d39.da8c2b","type":"mqtt in","z":"a107cfa3.03919","name":"","topic":"${Sensor4}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":660,"wires":[["c9c16dc0.77def8"]]},{"id":"c9c16dc0.77def8","type":"function","z":"a107cfa3.03919","name":"Store Temperatures Globally","func":"\ntemp_map = global.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nglobal.set('temperatures', {});","finalize":"","x":600,"y":480,"wires":[["87909d11.5d117"]]},{"id":"41328dd4.7546ac","type":"change","z":"a107cfa3.03919","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":360,"wires":[["cc4a5a56.8edbd8"]]},{"id":"17724958.f4808f","type":"mqtt in","z":"a107cfa3.03919","name":"","topic":"${automatic_topic}","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":290,"y":360,"wires":[["41328dd4.7546ac"]]},{"id":"cc4a5a56.8edbd8","type":"function","z":"a107cfa3.03919","name":"SetEnabledContext","func":"flow.set('is_enabled', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nflow.set('is_enabled', true);","finalize":"","x":760,"y":360,"wires":[["809e82a9.80a94"]]},{"id":"809e82a9.80a94","type":"function","z":"a107cfa3.03919","name":"Build Message","func":"msg = {};\nmsg.payload = {};\n\nmsg.payload.temperatures = flow.get('temperatures');\nmsg.payload.is_loading = flow.get('is_loading') || false; // default false\nmsg.payload.is_enabled = flow.get('is_enabled'); // enabled by default\nmsg.topic = env.get(\"load_topic\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":440,"wires":[[]]},{"id":"87909d11.5d117","type":"function","z":"a107cfa3.03919","name":"Store Temperatures Locally","func":"\ntemp_map = flow.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nflow.set('temperatures', {});","finalize":"","x":880,"y":480,"wires":[["809e82a9.80a94"]]},{"id":"9e55b69f.5978d8","type":"file in","z":"7a539137.52dbf","g":"5bd16a38.6f76fc","name":"","filename":"/home/pi/sens.yaml","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":420,"y":280,"wires":[["89a352e7.ba6b2"]]},{"id":"89a352e7.ba6b2","type":"yaml","z":"7a539137.52dbf","g":"5bd16a38.6f76fc","property":"payload","name":"","x":610,"y":280,"wires":[["b99f3cf6.b28e8"]]},{"id":"b99f3cf6.b28e8","type":"function","z":"7a539137.52dbf","g":"5bd16a38.6f76fc","name":"SetSensors","func":"flow.set('sensors', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":280,"wires":[[]]},{"id":"b15ab789.9ba838","type":"function","z":"7a539137.52dbf","g":"5bd16a38.6f76fc","name":"GetSensors","func":"return {'payload': flow.get('sensors')};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":440,"wires":[["72ad485f.6cc758"]]},{"id":"72ad485f.6cc758","type":"yaml","z":"7a539137.52dbf","g":"5bd16a38.6f76fc","property":"payload","name":"","x":570,"y":440,"wires":[["3efefea.4c50a82"]]},{"id":"3efefea.4c50a82","type":"file","z":"7a539137.52dbf","g":"5bd16a38.6f76fc","name":"","filename":"/home/pi/sens.yaml","appendNewline":true,"createDir":false,"overwriteFile":"true","encoding":"none","x":820,"y":440,"wires":[[]]},{"id":"60b8819b.a1f37","type":"split","z":"7a539137.52dbf","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1660,"y":700,"wires":[["ca2293c5.7385f8"]]},{"id":"67e2bea2.64c1f","type":"mqtt out","z":"7a539137.52dbf","name":"","topic":"","qos":"0","retain":"false","broker":"bcebf477.ab97e8","x":2010,"y":700,"wires":[]},{"id":"ca2293c5.7385f8","type":"function","z":"7a539137.52dbf","name":"IdAsTopic","func":"msg_out = {'topic': 'sensors/' + msg.payload.id, 'payload': msg.payload.temp}\n\n\nreturn msg_out;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":700,"wires":[["67e2bea2.64c1f"]]},{"id":"b1927554.1fc24","type":"change","z":"a107cfa3.03919","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":300,"wires":[["81a905c3.d3b5e"]]},{"id":"c9cc8f84.8acc58","type":"mqtt in","z":"a107cfa3.03919","name":"","topic":"${load_topic}","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":310,"y":300,"wires":[["b1927554.1fc24"]]},{"id":"81a905c3.d3b5e","type":"function","z":"a107cfa3.03919","name":"SetLoadingContext","func":"flow.set('is_loading', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":300,"wires":[[]]},{"id":"e5f66583.0b9608","type":"rpi-ds18b20","z":"86f356ab.03ac9","topic":"","array":true,"name":"","x":1170,"y":280,"wires":[["54a3201f.39f4f","e6f18ab7.19f49","13153a65.5fa73e"]]},{"id":"f9e3f519.250858","type":"inject","z":"86f356ab.03ac9","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":160,"wires":[["ddccb540.92268"]]},{"id":"54a3201f.39f4f","type":"delay","z":"86f356ab.03ac9","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1180,"y":380,"wires":[["e5f66583.0b9608"]]},{"id":"e6f18ab7.19f49","type":"split","z":"86f356ab.03ac9","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1500,"y":300,"wires":[["a34c06a1.789038"]]},{"id":"a34c06a1.789038","type":"function","z":"86f356ab.03ac9","name":"FileAsTopic","func":"msg_out = {'topic': 'raw_data/' + msg.payload.file, 'payload': msg.payload}\n\n\nreturn msg_out;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":300,"wires":[[]]},{"id":"9a79bf6f.4adf6","type":"function","z":"86f356ab.03ac9","name":"StoreInContext","func":"sensors_dict = flow.get('sensors');\n\n// Replace all the defined mappings\n//for (let sensor in msg.payload) {\n    sensors_dict[msg.payload.file] = msg.payload.id\n//}\n\nmsg = {'payload': sensors_dict}\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// Access the node's context object\n//var nodeContext = this.context;\n//var flowContext = this.context.flow;\n//var globalContext = this.context.global;\n\n\nflow.set('sensors', {});","finalize":"","x":1940,"y":540,"wires":[["3f9bf5db.52d082"]]},{"id":"e628c147.51e258","type":"ui_template","z":"86f356ab.03ac9","group":"8a48955d.4ec298","name":"","order":1,"width":0,"height":0,"format":"\n\n<form>\n    <fieldset style=\"width:85%\">\n    <legend>choose chartdata</legend>\n        <div ng-repeat=\"sensor in msg.payload\">\n            <label>{{sensor.file}}\n                <input  type=\"text\" style=\"float:right;\"\n                        ng-model=\"sensor.id\"\n                        ng-change=\"send({'payload': sensor})\"\n                        >\n            </label>\n        </div>\n    </fieldset>\n</form>\n\n<script>\n    \n    // Source: https://it.knightnet.org.uk/kb/nr-qa/dashboard-template-examples/#a-couple-of-ways-to-send-a-msg-back-to-node-red\n    \n    // Replace all the defined mappings\n    scope.on_change_2 = function(msg) {\n        sensors_dict = this.flow.get('sensors');\n        sensors_dict[msg.payload.file] = msg.payload.id\n        this.send(msg);\n    }.bind(scope);\n    \n    \n    ;(function (scope) {\n        \n        scope.on_change = function (msg) {\n            sensors_dict = scope.flow.get('sensors');\n            sensors_dict[msg.payload.file] = msg.payload.id\n            scope.send(msg);\n        }\n    })(scope)\n    \n</script>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":true,"templateScope":"local","x":1660,"y":540,"wires":[["9a79bf6f.4adf6","92143a82.c9f2f8"]]},{"id":"13153a65.5fa73e","type":"function","z":"86f356ab.03ac9","name":"Id2NameMapping","func":"sensors_dict = flow.get('sensors');\n\n// Replace all the defined mappings\nresult = {};\nresult.topic = msg.topic;\nresult.payload = [];\n\nfor (var sensor of msg.payload) {\n    if (sensor.file in sensors_dict) {\n        sensor.id = sensors_dict[sensor.file];\n    }\n    result.payload.push(sensor);\n}\n\nreturn result;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// Access the node's context object\n//var nodeContext = this.context;\n//var flowContext = this.context.flow;\n//var globalContext = this.context.global;\n\nflow.set('sensors', {})","finalize":"","x":1450,"y":540,"wires":[["e628c147.51e258","56aeff3c.9bdd58"]]},{"id":"92143a82.c9f2f8","type":"debug","z":"86f356ab.03ac9","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1900,"y":600,"wires":[]},{"id":"1de4b660.4b499a","type":"mqtt in","z":"52c26041.918658","name":"","topic":"${Sensor1}","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":540,"wires":[["3161a977.08049e"]]},{"id":"136510ee.761fd7","type":"mqtt in","z":"52c26041.918658","name":"","topic":"${Sensor2}","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":580,"wires":[["3161a977.08049e"]]},{"id":"27bed11b.dcf836","type":"mqtt in","z":"52c26041.918658","name":"","topic":"${Sensor3}","qos":"1","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":620,"wires":[["3161a977.08049e"]]},{"id":"eb9d72af.b8ad8","type":"mqtt in","z":"52c26041.918658","name":"","topic":"${Sensor4}","qos":"0","datatype":"auto","broker":"bcebf477.ab97e8","x":320,"y":660,"wires":[["3161a977.08049e"]]},{"id":"3161a977.08049e","type":"function","z":"52c26041.918658","name":"Store Temperatures Globally","func":"\ntemp_map = global.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nglobal.set('temperatures', {});","finalize":"","x":600,"y":480,"wires":[["2e16bd34.6d4c02"]]},{"id":"4b271d00.b5b774","type":"change","z":"52c26041.918658","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":360,"wires":[["806c8713.a05728"]]},{"id":"4de8826b.704d74","type":"mqtt in","z":"52c26041.918658","name":"","topic":"${automatic_topic}","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":290,"y":360,"wires":[["4b271d00.b5b774"]]},{"id":"806c8713.a05728","type":"function","z":"52c26041.918658","name":"SetEnabledContext","func":"flow.set('is_enabled', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nflow.set('is_enabled', true);","finalize":"","x":760,"y":360,"wires":[["5c0750df.bfd42"]]},{"id":"5c0750df.bfd42","type":"function","z":"52c26041.918658","name":"Build Message","func":"msg = {};\nmsg.payload = {};\n\nmsg.payload.temperatures = flow.get('temperatures');\nmsg.payload.is_loading = flow.get('is_loading') || false; // default false\nmsg.payload.is_enabled = flow.get('is_enabled'); // enabled by default\nmsg.topic = env.get(\"load_topic\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":440,"wires":[[]]},{"id":"2e16bd34.6d4c02","type":"function","z":"52c26041.918658","name":"Store Temperatures Locally","func":"\ntemp_map = flow.get('temperatures');\n\nif (typeof msg.topic !== 'undefined'){\n    temp_map[msg.topic] = msg.payload;\n    \n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\nflow.set('temperatures', {});","finalize":"","x":880,"y":480,"wires":[["5c0750df.bfd42"]]},{"id":"ddccb540.92268","type":"file in","z":"86f356ab.03ac9","g":"3d69e6e9.ceea6a","name":"","filename":"/home/pi/sens.yaml","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":420,"y":280,"wires":[["7653ec06.c2480c"]]},{"id":"7653ec06.c2480c","type":"yaml","z":"86f356ab.03ac9","g":"3d69e6e9.ceea6a","property":"payload","name":"","x":610,"y":280,"wires":[["418d2baa.7e2294"]]},{"id":"418d2baa.7e2294","type":"function","z":"86f356ab.03ac9","g":"3d69e6e9.ceea6a","name":"SetSensors","func":"flow.set('sensors', msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":280,"wires":[["e5f66583.0b9608"]]},{"id":"3f9bf5db.52d082","type":"function","z":"86f356ab.03ac9","g":"3d69e6e9.ceea6a","name":"GetSensors","func":"return {'payload': flow.get('sensors')};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":440,"wires":[["283a3b83.796df4"]]},{"id":"283a3b83.796df4","type":"yaml","z":"86f356ab.03ac9","g":"3d69e6e9.ceea6a","property":"payload","name":"","x":570,"y":440,"wires":[["bc332ed7.ed634"]]},{"id":"bc332ed7.ed634","type":"file","z":"86f356ab.03ac9","g":"3d69e6e9.ceea6a","name":"","filename":"/home/pi/sens.yaml","appendNewline":true,"createDir":false,"overwriteFile":"true","encoding":"none","x":820,"y":440,"wires":[[]]},{"id":"56aeff3c.9bdd58","type":"split","z":"86f356ab.03ac9","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1660,"y":700,"wires":[["60f51d31.76df4c"]]},{"id":"17b42043.626db","type":"mqtt out","z":"86f356ab.03ac9","name":"","topic":"","qos":"0","retain":"false","broker":"bcebf477.ab97e8","x":2010,"y":700,"wires":[]},{"id":"60f51d31.76df4c","type":"function","z":"86f356ab.03ac9","name":"IdAsTopic","func":"msg_out = {'topic': 'sensors/' + msg.payload.id, 'payload': msg.payload.temp}\n\n\nreturn msg_out;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":700,"wires":[["17b42043.626db"]]},{"id":"a11beeb7.df22e","type":"change","z":"52c26041.918658","name":"String2Boolean","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"str","to":"true","tot":"bool"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":300,"wires":[["57d8c905.2897"]]},{"id":"aaad0157.c2be68","type":"mqtt in","z":"52c26041.918658","name":"","topic":"${load_topic}","qos":"2","datatype":"auto","broker":"bcebf477.ab97e8","x":310,"y":300,"wires":[["a11beeb7.df22e"]]},{"id":"57d8c905.2897","type":"function","z":"52c26041.918658","name":"SetLoadingContext","func":"flow.set('is_loading', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":300,"wires":[[]]},{"id":"6cd6394d.f6c2b8","type":"http request","z":"37d3dae1.129ff6","name":"get sensors","method":"GET","ret":"obj","paytoqs":"ignore","url":"http://127.0.0.1:1880/sensors/1wire/","tls":"","persist":false,"proxy":"","authType":"","x":370,"y":560,"wires":[["c0e746b.0742fb8"]]},{"id":"f6c5c972.2b0618","type":"ui_dropdown","z":"37d3dae1.129ff6","name":"temp sensor","label":"","tooltip":"","place":"Select option","group":"10788b43.59cf15","order":4,"width":0,"height":0,"passthru":false,"multiple":false,"options":[],"payload":"","topic":"","topicType":"str","x":730,"y":560,"wires":[["792892fa.072fdc"]]},{"id":"29b7af68.1e6d2","type":"sensor-dynamic-ds18b20","z":"37d3dae1.129ff6","name":"","topic":"","x":870,"y":200,"wires":[["d3f750fc.27e4c"]]},{"id":"792892fa.072fdc","type":"change","z":"37d3dae1.129ff6","name":"","rules":[{"t":"set","p":"temp_sensorid","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":560,"wires":[[]]},{"id":"3784d17d.192d4e","type":"ui_button","z":"37d3dae1.129ff6","name":"Retrieve sensors","group":"10788b43.59cf15","order":1,"width":0,"height":0,"passthru":false,"label":"Retrieve sensors","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","topicType":"str","x":160,"y":560,"wires":[["6cd6394d.f6c2b8"]]},{"id":"62103c5a.16a0c4","type":"inject","z":"37d3dae1.129ff6","name":"","props":[],"repeat":"10","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":110,"y":200,"wires":[["f4987ea6.223a9"]]},{"id":"c0e746b.0742fb8","type":"change","z":"37d3dae1.129ff6","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"temp_sensorid","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":560,"wires":[["f6c5c972.2b0618"]]},{"id":"1f287f49.95e5c1","type":"config","z":"37d3dae1.129ff6","name":"Sensor Mapping","properties":[{"p":"sensor_mapping","pt":"global","to":"{\"28-0004633651ff\":\"sensors/aussentemperatur\",\"28-00044a21bcff\":\"sensors/heizkreis/vorlauf_ist\",\"28-0004641778ff\":\"sensors/heizraum/1\",\"28-00044c86b7ff\":\"sensors/heizraum/2\",\"28-0004633961ff\":\"sensors/heizraum/3\",\"28-0004612509ff\":\"sensors/heizraum/4\",\"28-0004633827ff\":\"sensors/heizkreis/1\",\"28-00046335f6ff\":\"sensors/heizkreis/2\",\"28-00044e6b6dff\":\"sensors/heizkreis/3\",\"28-00044c86c8ff\":\"sensors/heizkreis/4\",\"28-00044e7edbff\":\"sensors/brauchwasser/1\",\"28-00044e7371ff\":\"sensors/brauchwasser/2\",\"28-00044e75daff\":\"sensors/brauchwasser/3\",\"28-0004633498ff\":\"sensors/brauchwasser/4\"}","tot":"json"}],"active":true,"x":460,"y":120,"wires":[]},{"id":"3a0706f5.8727ba","type":"inject","z":"37d3dae1.129ff6","name":"Initialize Configuration","props":[],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":200,"y":120,"wires":[["1f287f49.95e5c1"]]},{"id":"f4987ea6.223a9","type":"function","z":"37d3dae1.129ff6","name":"Get Sensor Mapping","func":"msg.payload = global.get(\"sensor_mapping\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":200,"wires":[["4f912922.a5a728"]]},{"id":"4f912922.a5a728","type":"split","z":"37d3dae1.129ff6","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":490,"y":200,"wires":[["8891db13.d06b38"]]},{"id":"bbe2caec.ae1e88","type":"http request","z":"8bcecb62.c30a28","name":"get sensors","method":"GET","ret":"obj","paytoqs":"ignore","url":"http://127.0.0.1:1880/sensors/1wire/","tls":"","persist":false,"proxy":"","authType":"","x":400,"y":120,"wires":[["f510c18a.849fb"]]},{"id":"f510c18a.849fb","type":"function","z":"8bcecb62.c30a28","name":"","func":"\nvar listArray = [];\n\nmsg.options = msg.payload;\nmsg.payload = global.get('temp_sensorid');\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":120,"wires":[["47b8a413.4d57bc"]]},{"id":"47b8a413.4d57bc","type":"ui_dropdown","z":"8bcecb62.c30a28","name":"temp sensor","label":"","tooltip":"","place":"Select option","group":"10788b43.59cf15","order":4,"width":0,"height":0,"passthru":false,"multiple":false,"options":[],"payload":"","topic":"","topicType":"str","x":760,"y":120,"wires":[["7fce0cd1.829204"]]},{"id":"38ad0f14.d1ba8","type":"sensor-dynamic-ds18b20","z":"8bcecb62.c30a28","name":"temp","topic":"","x":470,"y":220,"wires":[["7c45ae07.242f5","81c3218a.d582c"]]},{"id":"7c45ae07.242f5","type":"ui_text","z":"8bcecb62.c30a28","group":"10788b43.59cf15","order":3,"width":0,"height":0,"name":"","label":"Current temp","format":"{{msg.payload}}","layout":"row-spread","x":630,"y":220,"wires":[]},{"id":"81c3218a.d582c","type":"debug","z":"8bcecb62.c30a28","name":"DS18B20 output","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":650,"y":260,"wires":[]},{"id":"968c16d6.7f4358","type":"function","z":"8bcecb62.c30a28","name":"","func":"\nvar listArray = [];\n\nmsg.sensorid = global.get('temp_sensorid');\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":220,"wires":[["38ad0f14.d1ba8"]]},{"id":"7fce0cd1.829204","type":"change","z":"8bcecb62.c30a28","name":"","rules":[{"t":"set","p":"temp_sensorid","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":120,"wires":[[]]},{"id":"999e56e2.1ed258","type":"ui_button","z":"8bcecb62.c30a28","name":"Retrieve sensors","group":"10788b43.59cf15","order":1,"width":0,"height":0,"passthru":false,"label":"Retrieve sensors","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","topicType":"str","x":190,"y":120,"wires":[["bbe2caec.ae1e88"]]},{"id":"e5872407.c89348","type":"inject","z":"8bcecb62.c30a28","name":"","props":[],"repeat":"5","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":160,"y":220,"wires":[["968c16d6.7f4358"]]},{"id":"9f3429c6.bb95f8","type":"inject","z":"8bcecb62.c30a28","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":480,"y":180,"wires":[["7c45ae07.242f5"]]},{"id":"8891db13.d06b38","type":"function","z":"37d3dae1.129ff6","name":"Prepare msg","func":"msg.sensorid = msg.topic\nmsg.topic = msg.payload;\nmsg.payload = undefined\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":200,"wires":[["29b7af68.1e6d2"]]},{"id":"17d69ca2.031613","type":"mqtt out","z":"37d3dae1.129ff6","name":"Publish msg","topic":"","qos":"2","retain":"false","broker":"bcebf477.ab97e8","x":1050,"y":300,"wires":[]},{"id":"d3f750fc.27e4c","type":"switch","z":"37d3dae1.129ff6","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":770,"y":320,"wires":[["17d69ca2.031613","d6cf5083.fdc6f"]]},{"id":"d6cf5083.fdc6f","type":"debug","z":"37d3dae1.129ff6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":990,"y":380,"wires":[]},{"id":"3655d9dc.712db6","type":"comment","z":"37d3dae1.129ff6","name":"This is just an exaple for receiving a list of available sensor ids","info":"","x":560,"y":520,"wires":[]}]